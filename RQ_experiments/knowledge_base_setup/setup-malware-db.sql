-- Step 1: Create Database (if it does not exist)
CREATE DATABASE malware_kb;


-- Step 2: Connect to the Database
\c malware_kb;

-- Step 3: Create Schema
CREATE SCHEMA IF NOT EXISTS malware;

-- Step 4: Create Users

CREATE ROLE malware_admin WITH LOGIN PASSWORD 'admin_secure_password';
CREATE ROLE malware_user WITH LOGIN PASSWORD 'user_secure_password';


-- Step 5: Grant Privileges to malware_admin
GRANT ALL PRIVILEGES ON DATABASE malware_kb TO malware_admin;
GRANT USAGE, CREATE ON SCHEMA malware TO malware_admin;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA malware TO malware_admin;
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA malware TO malware_admin;

-- Step 6: Grant Privileges to malware_user
GRANT CONNECT ON DATABASE malware_kb TO malware_user;
GRANT USAGE ON SCHEMA malware TO malware_user;
GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA malware TO malware_user;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA malware TO malware_user;

-- Ensure Future Tables are Accessible
ALTER DEFAULT PRIVILEGES IN SCHEMA malware GRANT ALL ON TABLES TO malware_admin;
ALTER DEFAULT PRIVILEGES IN SCHEMA malware GRANT SELECT, INSERT, UPDATE, DELETE ON TABLES TO malware_user;

-- Step 7: Enable vector Extension
CREATE EXTENSION IF NOT EXISTS vector SCHEMA malware;
